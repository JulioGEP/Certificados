<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>GEP Group · Generador de Certificados</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="icon" type="image/png" href="assets/GEP_Logo_Icono_Rojo.png" />
    <link rel="stylesheet" href="assets/css/styles.css" />
  </head>
  <body>
    <main class="page-wrapper">
      <section class="hero-section">
        <div class="container">
          <div class="hero-header">
            <img
              src="assets/GEP-Group_Logotipo_horizontal.png"
              alt="Logotipo GEP Group"
              class="hero-logo"
            />
            <h1 class="hero-title">Certificados</h1>
          </div>
        </div>
      </section>

      <section class="content-section pb-5">
        <div class="container">
          <div id="alert-container" class="mb-4" aria-live="polite"></div>

          <div class="card border-0 shadow-sm mb-4 budget-card">
            <div class="card-body">
              <form id="budget-form" class="row g-3 align-items-end">
                <div class="col-lg-8">
                  <label for="budget-input" class="form-label fw-medium"
                    >Número de presupuesto</label
                  >
                  <input
                    type="text"
                    class="form-control"
                    id="budget-input"
                    name="budget"
                    placeholder="ejemplo: 6574,6456,7366,..."
                    autocomplete="off"
                    required
                  />
                </div>
                <div class="col-lg-4">
                  <div class="d-flex flex-column flex-sm-row gap-2">
                    <button
                      type="submit"
                      class="btn btn-primary flex-fill d-flex align-items-center justify-content-center gap-2"
                      id="fill-button"
                    >
                      <span class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                      <span class="button-text">Añadir alumn@/s</span>
                    </button>
                    <button
                      type="button"
                      class="btn btn-outline-primary flex-fill"
                      id="manage-templates-button"
                      data-bs-toggle="modal"
                      data-bs-target="#training-templates-modal"
                    >
                      Modificar Plantillas
                    </button>
                  </div>
                </div>
              </form>
            </div>
          </div>

          <div class="d-flex flex-column flex-lg-row justify-content-between align-items-lg-center gap-3 mb-3">
            <h2 class="h4 mb-0">Listado de alumnos</h2>
            <div class="d-flex flex-wrap gap-2">
              <button class="btn btn-success" type="button" id="add-manual-row">
                Añadir fila
              </button>
              <button class="btn btn-outline-primary" type="button" id="upload-document-button">
                Subir DOC
              </button>
              <button
                class="btn btn-outline-secondary"
                type="button"
                id="clear-storage"
              >
                Vaciar listado
              </button>
              <button class="btn btn-primary" type="button" id="generate-all-certificates">
                Todos PDF's
              </button>
              <button
                class="btn btn-outline-success btn-icon"
                type="button"
                id="send-all-to-drive"
                aria-label="Enviar todos a Google Drive"
                title="Enviar todos a Google Drive"
              >
                <svg
                  class="icon icon-google-drive"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 64 64"
                  aria-hidden="true"
                  focusable="false"
                >
                  <polygon fill="#FBBC04" points="32 6 44 26 20 26"></polygon>
                  <polygon fill="#0F9D58" points="6 54 20 26 32 46 18 54"></polygon>
                  <polygon fill="#4285F4" points="58 54 44 26 32 46 46 54"></polygon>
                </svg>
              </button>
              <button
                class="btn btn-outline-secondary btn-icon"
                type="button"
                id="send-all-by-email"
                aria-label="Enviar todos por correo"
                title="Enviar todos por correo"
              >
                <svg
                  class="icon icon-envelope"
                  xmlns="http://www.w3.org/2000/svg"
                  viewBox="0 0 24 24"
                  aria-hidden="true"
                  focusable="false"
                >
                  <path
                    fill="currentColor"
                    d="M4 4h16a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2zm0 2v.4l8 5.2 8-5.2V6H4zm16 2.8-6.92 4.49a3 3 0 0 1-3.16 0L4 8.8V18h16V8.8z"
                  ></path>
                </svg>
              </button>
            </div>
          </div>

          <div class="table-responsive rounded-4 shadow-sm overflow-hidden">
            <table class="table align-middle mb-0" id="students-table">
              <thead class="table-light text-uppercase small">
                <tr>
                  <th scope="col">Presu</th>
                  <th scope="col">Nombre</th>
                  <th scope="col">Apellidos</th>
                  <th scope="col">DNI / NIE</th>
                  <th scope="col">Fecha</th>
                  <th scope="col">2ª Fecha</th>
                  <th scope="col">Lugar</th>
                  <th scope="col" class="column-hours">Horas</th>
                  <th scope="col">Cliente</th>
                  <th scope="col">Formación</th>
                  <th scope="col">IRATA</th>
                  <th scope="col" class="text-center">Acciones</th>
                </tr>
              </thead>
              <tbody id="table-body"></tbody>
            </table>
          </div>
        </div>
      </section>
    </main>

    <div
      class="modal fade"
      id="training-templates-modal"
      tabindex="-1"
      aria-labelledby="training-templates-modal-label"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-dialog-scrollable modal-lg">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="training-templates-modal-label">
              Modificar plantillas de formación
            </h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form id="training-template-form" class="vstack gap-3">
              <div>
                <label for="template-selector" class="form-label">Plantilla disponible</label>
                <select id="template-selector" class="form-select" aria-describedby="template-selector-help">
                  <option value="" selected disabled>Selecciona una plantilla…</option>
                </select>
                <div id="template-selector-help" class="form-text">
                  Elige una plantilla existente o selecciona "Crear nueva plantilla" para empezar desde cero.
                </div>
              </div>
              <div class="row g-3">
                <div class="col-lg-6">
                  <label for="template-name" class="form-label">Nombre de la formación</label>
                  <input
                    type="text"
                    id="template-name"
                    class="form-control"
                    placeholder="Nombre interno de la formación"
                    required
                  />
                </div>
                <div class="col-lg-6">
                  <label for="template-title" class="form-label">Título de la formación</label>
                  <input
                    type="text"
                    id="template-title"
                    class="form-control"
                    placeholder="Título que aparecerá en el certificado"
                    required
                  />
                  <div class="form-text">Este título se utilizará en el PDF del certificado.</div>
                </div>
              </div>
              <div>
                <label for="template-duration" class="form-label">Duración de la formación</label>
                <input
                  type="text"
                  id="template-duration"
                  class="form-control"
                  placeholder="Por ejemplo: 8h"
                />
              </div>
              <div class="row g-4">
                <div class="col-lg-6">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h2 class="h6 mb-0">Parte teórica</h2>
                    <button type="button" class="btn btn-outline-primary btn-sm" id="add-theory-point">
                      Añadir punto
                    </button>
                  </div>
                  <div id="theory-list" class="vstack gap-2"></div>
                </div>
                <div class="col-lg-6">
                  <div class="d-flex justify-content-between align-items-center mb-2">
                    <h2 class="h6 mb-0">Parte práctica</h2>
                    <button type="button" class="btn btn-outline-primary btn-sm" id="add-practice-point">
                      Añadir punto
                    </button>
                  </div>
                  <div id="practice-list" class="vstack gap-2"></div>
                </div>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-outline-danger me-auto"
              id="delete-template-button"
              disabled
            >
              Eliminar plantilla
            </button>
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cerrar</button>
            <button type="submit" form="training-template-form" class="btn btn-primary">Guardar plantilla</button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="email-modal"
      tabindex="-1"
      aria-labelledby="email-modal-label"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="email-modal-label">Enviar certificado por correo</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form id="email-form" class="vstack gap-3" novalidate>
              <div id="email-status" class="alert d-none" role="alert"></div>
              <p
                id="email-bulk-counter"
                class="text-muted text-end small d-none"
                aria-live="polite"
              ></p>
              <div>
                <label for="email-to" class="form-label">Para</label>
                <input
                  type="text"
                  class="form-control"
                  id="email-to"
                  name="email-to"
                  placeholder="correo@empresa.com"
                  autocomplete="off"
                  inputmode="email"
                  spellcheck="false"
                  required
                />
              </div>
              <div>
                <label for="email-cc" class="form-label">CC</label>
                <input
                  type="text"
                  class="form-control"
                  id="email-cc"
                  name="email-cc"
                  value="contabilidad@gepgroup.es"
                  autocomplete="off"
                  inputmode="email"
                  spellcheck="false"
                />
              </div>
              <div>
                <label for="email-bcc" class="form-label">CCO</label>
                <input
                  type="text"
                  class="form-control"
                  id="email-bcc"
                  name="email-bcc"
                  placeholder="Añade destinatarios en copia oculta"
                  autocomplete="off"
                  inputmode="email"
                  spellcheck="false"
                />
              </div>
              <div>
                <label class="form-label" for="email-subject-preview">Asunto</label>
                <p id="email-subject-preview" class="form-control-plaintext mb-0"></p>
                <input type="hidden" id="email-subject" name="email-subject" />
              </div>
              <div>
                <label for="email-body" class="form-label">Cuerpo</label>
                <textarea class="form-control" id="email-body" name="email-body" rows="8" required></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" form="email-form" class="btn btn-primary" id="email-send-button">Enviar correo</button>
          </div>
        </div>
      </div>
    </div>

    <div
      class="modal fade"
      id="document-upload-modal"
      tabindex="-1"
      aria-labelledby="document-upload-modal-label"
      aria-hidden="true"
    >
      <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header">
            <h1 class="modal-title fs-5" id="document-upload-modal-label">Subir documento de alumnado</h1>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Cerrar"></button>
          </div>
          <div class="modal-body">
            <form id="document-upload-form" class="vstack gap-4" novalidate>
              <div>
                <label for="document-upload-budget" class="form-label">Número de presupuesto</label>
                <input
                  type="text"
                  class="form-control"
                  id="document-upload-budget"
                  name="document-upload-budget"
                  placeholder="Introduce el número de presupuesto"
                  autocomplete="off"
                  required
                />
                <div class="form-text">Utilizaremos este presupuesto para completar la información de la formación.</div>
              </div>

              <div>
                <label for="document-upload-file-input" class="form-label">Documento del alumnado</label>
                <div class="document-upload-dropzone" id="document-upload-dropzone" role="button" tabindex="0">
                  <div class="document-upload-placeholder">
                    <svg
                      class="document-upload-illustration"
                      xmlns="http://www.w3.org/2000/svg"
                      viewBox="0 0 64 64"
                      aria-hidden="true"
                      focusable="false"
                    >
                      <path
                        fill="var(--brand-primary)"
                        d="M40 4H16a4 4 0 0 0-4 4v48a4 4 0 0 0 4 4h32a4 4 0 0 0 4-4V20L40 4z"
                        opacity="0.1"
                      ></path>
                      <path
                        fill="var(--brand-primary)"
                        d="M40 4H16a4 4 0 0 0-4 4v48a4 4 0 0 0 4 4h32a4 4 0 0 0 4-4V20z"
                        opacity="0.08"
                      ></path>
                      <path
                        fill="var(--brand-primary)"
                        d="M40 4v12a4 4 0 0 0 4 4h12"
                        opacity="0.2"
                      ></path>
                      <path
                        fill="none"
                        stroke="var(--brand-primary)"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M40 4H16a4 4 0 0 0-4 4v48a4 4 0 0 0 4 4h32a4 4 0 0 0 4-4V20z"
                      ></path>
                      <path
                        fill="none"
                        stroke="var(--brand-primary)"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="M40 4v12a4 4 0 0 0 4 4h12"
                      ></path>
                      <path
                        fill="none"
                        stroke="var(--brand-primary)"
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        stroke-width="2"
                        d="m22 34 6 6 14-14"
                      ></path>
                    </svg>
                    <p class="document-upload-title mb-1">Arrastra y suelta el documento aquí</p>
                    <p class="document-upload-subtitle mb-3">Admite PDF, Excel o imagen (máx. 10&nbsp;MB)</p>
                    <span class="document-upload-action btn btn-outline-primary btn-sm">Seleccionar archivo</span>
                    <p class="document-upload-selected-file text-body-secondary small mb-0 d-none" id="document-upload-file-name"></p>
                  </div>
                  <input
                    type="file"
                    class="visually-hidden"
                    id="document-upload-file-input"
                    name="document-upload-file-input"
                    accept=".pdf,.xls,.xlsx,.csv,.ods,image/*"
                  />
                </div>
                <div class="form-text">Procesaremos el archivo con OpenAI para obtener los nombres y documentos del alumnado.</div>
              </div>

              <div id="document-upload-error" class="alert alert-danger d-none" role="alert"></div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
            <button type="submit" form="document-upload-form" class="btn btn-primary" id="document-upload-submit">
              <span
                class="spinner-border spinner-border-sm align-middle me-2 d-none"
                id="document-upload-submit-spinner"
                role="status"
                aria-hidden="true"
              ></span>
              <span class="align-middle" id="document-upload-submit-label">Procesar documento</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
      crossorigin="anonymous"
    ></script>
    <script defer src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.7/build/pdfmake.min.js"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/pdfmake@0.2.7/build/vfs_fonts.js"></script>
    <script>
      window.GOOGLE_DRIVE_CONFIG = {
        clientId: '236363806815-nlfr4ck0gs2krh4l1nn4b3l7l83offng.apps.googleusercontent.com',
        rootFolderId: '15FclFHgqFha76Y51OnzJxypxxvgI-Pr6'
      };

      window.GOOGLE_GMAIL_CONFIG = {
        clientId: '236363806815-nlfr4ck0gs2krh4l1nn4b3l7l83offng.apps.googleusercontent.com'
      };
    </script>
    <script src="assets/js/google-drive.js" defer></script>
    <script src="assets/js/google-gmail.js" defer></script>
    <script src="assets/js/training-templates.js" defer></script>
    <script src="assets/js/certificate-pdf.js" defer></script>
    <script src="assets/js/brand-assets.js" defer></script>
    <script src="assets/js/app.js" defer></script>
  </body>
</html>
